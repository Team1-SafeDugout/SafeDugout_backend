<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="main">

	<!-- 로그인한 회원 정보 가져오기 -->
	<select id="selectLoginMember" parameterType="int" resultType="MemberDTO">
		SELECT * FROM TBL_MEMBER 
		WHERE MEMBER_NUMBER = #{memberNumber}
	</select>
	
	<!-- 메인 공지사항 목록 조회 -->
	<select id="selectMainList" resultType="MainNoticePostDTO">
	<![CDATA[
	SELECT *
	FROM (
	    SELECT ROWNUM AS rnum, subquery.*
	    FROM (
	        SELECT NOTICE_POST_NUMBER,
	               NOTICE_POST_TITLE,
	               NOTICE_POST_DATE
	        FROM TBL_NOTICE_POST 
	        WHERE NOTICE_TYPE_ID = 1
	        ORDER BY NOTICE_POST_DATE DESC
	    ) subquery
	)
	WHERE rnum BETWEEN #{startRow} AND #{endRow}
	]]>
	</select>
	
	<!-- 메인 공지사항 최신 항목(제목) 가져오기 -->
	<select id="getRecent" resultType="MainNoticePostDTO">
		SELECT * FROM 
		(SELECT NOTICE_POST_TITLE
		FROM TBL_NOTICE_POST
		WHERE NOTICE_TYPE_ID = 1
		ORDER BY NOTICE_POST_DATE DESC)
		WHERE ROWNUM = 1
	</select>
	
	<!-- 입문 가이드 최신 항목(제목) 가져오기 -->
	<select id="getRecentGuide" resultType="GuidePostDTO">
		SELECT * FROM 
		(SELECT NOTICE_POST_TITLE
		FROM TBL_NOTICE_POST
		WHERE NOTICE_TYPE_ID = 3
		ORDER BY NOTICE_POST_DATE DESC)
		WHERE ROWNUM = 1
	</select>
	
	<!-- 공지사항 총 개수 가져오기 -->
	<select id="getTotalMainList" resultType="int">
		SELECT COUNT(NOTICE_POST_NUMBER)
		FROM TBL_NOTICE_POST	
		WHERE NOTICE_TYPE_ID = 1
	</select>
	
	<!-- 메인 공지사항 상세 조회 -->
	<select id="selectMainDetail" parameterType="int" resultType="MainNoticePostDTO">
		select notice_post_number, notice_post_title, notice_post_date, notice_post_update,
		notice_post_content
		from tbl_notice_post
		where notice_type_id = 1 and notice_post_number = #{noticePostNumber}
	</select>
	
	<!-- 메인 공지사항 상세 조회 (이전글) -->
	<select id="selectMainPrev" parameterType="int" resultType="MainNoticePostDTO">
	<![CDATA[
	SELECT notice_post_number, 
			notice_post_title, 
			notice_post_date, 
			notice_post_update,
			notice_post_content
	FROM (SELECT rownum rn2, n.* FROM tbl_notice_post n)
	WHERE rn2 = (SELECT rn - 1 FROM (
		SELECT rownum rn, n2.notice_post_number
		FROM tbl_notice_post n2
		WHERE n2.notice_type_id = 1
		order by n2.notice_post_number desc) subquery
		WHERE subquery.notice_post_number = #{noticePostNumber}
	)
	]]>
	</select>
	
	<!-- 메인 공지사항 상세 조회 (다음글) -->
	<select id="selectMainNext" parameterType="int" resultType="MainNoticePostDTO">
	<![CDATA[
	SELECT notice_post_number, 
			notice_post_title, 
			notice_post_date, 
			notice_post_update,
			notice_post_content
	FROM (SELECT rownum rn2, n.* FROM tbl_notice_post n)
	WHERE rn2 = (SELECT rn + 1 FROM (
		SELECT rownum rn, n2.notice_post_number
		FROM tbl_notice_post n2
		WHERE n2.notice_type_id = 1
		order by n2.notice_post_number desc) subquery
		WHERE subquery.notice_post_number = #{noticePostNumber}
	)
	]]>
	</select>
	
	<!-- 현재 메인 공지사항 항목 순서 가져오기 -->
	<select id="getMainIndex" parameterType="int" resultType="int">
	<![CDATA[
		SELECT rn FROM (
			SELECT rownum rn, n2.notice_post_number
			FROM tbl_notice_post n2
			WHERE n2.notice_type_id = 1
			order by n2.notice_post_number desc) subquery
		WHERE subquery.notice_post_number = #{noticePostNumber}
	]]>
	</select>
	
	<!-- 경기 일정 목록 조회 -->
	<select id="selectSchedule" resultType="MainDTO">
	<![CDATA[
		select t1.team_name as away_team_name , st.stadium_name, t2.team_name as home_team_name, 
		to_char(sc.schedule_date, 'HH:mi') as schedule_date
		from tbl_game_schedule sc join tbl_stadium st on sc.home_team_number = st.team_number
		join tbl_team t1 on sc.home_team_number = t1.team_number
		join tbl_team t2 on sc.away_team_number = t2.team_number
		WHERE trunc(sc.schedule_date) = trunc(to_date('2025.08.29', 'YYYY.MM.DD')) and rownum <= 5
	]]>
	</select>
	
	<!-- 판매글 목록 조회 -->
	<select id="selectSellList" resultType="MainDTO">
	<![CDATA[
		select s.sell_post_number, s.sell_post_title, s.sell_post_creation_date, s.price_point,
		a.attachment_path
		from tbl_sell_post s join tbl_attachment a on s.sell_post_number = a.sell_post_number
	]]>
	</select>
	
	<!-- 팀 순위 목록 조회 -->
	<select id="selectTeamRank" resultType="MainDTO">
	<![CDATA[
		select r.team_rank, t.team_name, r.game_count, r.team_win, r.team_draw, r.team_lose, r.team_win_rate
		from tbl_team_record r join tbl_team t on r.team_number = t.team_number
		where season_year = to_number(to_char(sysdate, 'YYYY'))
		order by r.team_win_rate desc
	]]>
	</select>
	
	<!-- 입문자 가이드 목록 조회 -->
	<select id="selectGuideList" resultType="MainDTO">
	<![CDATA[
		select notice_post_number, notice_post_title, notice_post_date
		from tbl_notice_post
		where notice_type_id = 3
	]]>	
	</select>
	
</mapper>