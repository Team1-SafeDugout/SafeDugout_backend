<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminFreePost">
	<!-- 전체 커뮤니티 게시글 목록 조회 -->
	<select id="listSelect" resultType="AdminUserPostDTO" parameterType = "map">
	<![CDATA[
	SELECT *
	FROM (
	    SELECT ROWNUM AS rnum, subquery.*
	    FROM (
	        SELECT P.POST_NUMBER,
	               P.POST_TITLE,
	               P.POST_CONTENT,
	               P.POST_DATE,
	               P.POST_UPDATE,
	               M.MEMBER_ID,
	               M.MEMBER_NUMBER,
	               P.BOARD_ID,
	               P.TEAM_NUMBER,
	               TA.ATTACHMENT_PATH
	        FROM TBL_POST P
	        JOIN TBL_MEMBER M ON P.MEMBER_NUMBER = M.MEMBER_NUMBER
	        LEFT JOIN TBL_ATTACHMENT TA ON P.POST_NUMBER = TA.POST_NUMBER
	        WHERE P.BOARD_ID = 1
	        ORDER BY P.POST_DATE DESC
	    ) subquery
	)
	WHERE rnum BETWEEN #{startRow} AND #{endRow}
	]]>
	</select>
	
	<!-- 전체 커뮤니티 게시글 전체수 -->
	<select id="total" resultType="int">
		SELECT COUNT(P.POST_NUMBER)
		FROM TBL_POST P
		JOIN TBL_MEMBER M ON P.MEMBER_NUMBER = M.MEMBER_NUMBER
		WHERE P.BOARD_ID = 1
		ORDER BY P.POST_DATE DESC
	</select>

	
	<!-- 모든 게시글 목록 조회 -->
	<select id="listSelectAll" resultType="AdminUserPostDTO" parameterType = "map">
	<![CDATA[
	SELECT *
	FROM (
	    SELECT ROWNUM AS rnum, subquery.*
	    FROM (
	        SELECT P.POST_NUMBER,
	               P.POST_TITLE,
	               P.POST_CONTENT,
	               P.POST_DATE,
	               P.POST_UPDATE,
	               M.MEMBER_ID,
	               M.MEMBER_NUMBER,
	               P.BOARD_ID
	        FROM TBL_POST P
	        JOIN TBL_MEMBER M ON P.MEMBER_NUMBER = M.MEMBER_NUMBER
	        WHERE P.BOARD_ID = 1 OR P.BOARD_ID = 2
	        ORDER BY P.POST_DATE DESC
	    ) subquery
	)
	WHERE rnum BETWEEN #{startRow} AND #{endRow}
	]]>
	</select>

	<!-- 모든 게시글 전체수 -->
	<select id="totalAll" resultType="int">
		SELECT COUNT(P.POST_NUMBER)
		FROM TBL_POST P
		JOIN TBL_MEMBER M ON P.MEMBER_NUMBER = M.MEMBER_NUMBER
		WHERE P.BOARD_ID = 1 OR P.BOARD_ID = 2
		ORDER BY P.POST_DATE DESC
	</select>
	
	<!-- 게시글 상세 조회 -->
	
	
	<select id = "selectDetail" resultType = "AdminUserPostDTO" parameterType = "int">
		SELECT P.POST_NUMBER,
		       P.POST_TITLE,
		       P.POST_CONTENT,
		       P.POST_DATE,
		       P.POST_UPDATE,
		       M.MEMBER_ID,
		       M.MEMBER_NUMBER,
		       P.BOARD_ID
		FROM TBL_POST P
		JOIN TBL_MEMBER M ON P.MEMBER_NUMBER = M.MEMBER_NUMBER
		WHERE P.POST_NUMBER = #{postNumber}
	</select>

	
	<!-- 게시글 삭제 -->
	<delete id="delete" parameterType="int">
	    DELETE FROM TBL_POST
	    WHERE POST_NUMBER = #{postNumber}
	</delete>
</mapper>