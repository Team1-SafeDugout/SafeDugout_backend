<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="teamMain">

	<!-- <![CDATA[
	SELECT *
	FROM (
	    SELECT ROWNUM AS rnum, subquery.*
	    FROM (
	        SELECT P.POST_NUMBER,
	               P.POST_TITLE,
	               P.POST_CONTENT,
	               P.POST_DATE,
	               M.MEMBER_ID
	        FROM TBL_POST P
	        JOIN TBL_MEMBER M ON P.MEMBER_NUMBER = M.MEMBER_NUMBER
	        WHERE P.BOARD_ID = 2
	          AND P.TEAM_NUMBER = {teamNumber}
	        ORDER BY P.POST_DATE DESC
	    ) subquery
	)
	WHERE rnum BETWEEN #{startRow} AND #{endRow}
	]]> -->
	
	<!-- 팀 뉴스 목록 조회(5개) -->
	<select id="selectNewsList" resultType="TeamMainDTO">
	<![CDATA[
	SELECT *
	FROM (
	    SELECT ROWNUM AS rnum, subquery.*
	    FROM (
	        SELECT P.POST_TITLE
	        FROM TBL_POST P
	        WHERE BOARD_ID = 3
	          AND TEAM_NUMBER = #{teamNumber}
	        ORDER BY POST_DATE DESC
	    ) subquery
	)
	WHERE rnum <= 5
	]]>
	</select>

	<!-- 팀 게시글 목록 조회(10개) -->
	<select id="selectPostList" resultType="TeamMainDTO">
	<![CDATA[
	SELECT *
	FROM (
	    SELECT ROWNUM AS rnum, subquery.*
	    FROM (
	        SELECT P.POST_NUMBER,
	               P.POST_TITLE,
	               M.MEMBER_ID,
	               P.POST_DATE
	        FROM TBL_POST P 
	        JOIN TBL_MEMBER M ON P.MEMBER_NUMBER = M.MEMBER_NUMBER
	        WHERE P.BOARD_ID = 2
	          AND P.TEAM_NUMBER = #{teamNumber}
	        ORDER BY P.POST_DATE DESC
	    ) subquery
	)
	WHERE rnum <= 10
	]]>
	</select>

	<!-- 팀 유튜브 썸네일 목록 조회(3개) -->
	<select id="selectYouTubeList" resultType="TeamMainDTO">
	<![CDATA[
	SELECT *
	FROM (
	    SELECT ROWNUM AS rnum, subquery.*
	    FROM (
	        SELECT A.ATTACHMENT_PATH,
	        	   P.POST_LINK
	        FROM TBL_POST P
	        JOIN TBL_POST_ATTACHMENT PA ON P.POST_NUMBER = PA.POST_NUMBER
	        JOIN TBL_ATTACHMENT A ON PA.ATTACHMENT_NUMBER = A.ATTACHMENT_NUMBER
	        WHERE P.BOARD_ID = 4
	          AND P.TEAM_NUMBER = #{teamNumber}
	        ORDER BY P.POST_DATE DESC
	    ) subquery
	)
	WHERE rnum <= 3
	]]>
	</select>

	<!-- 팀별 경기 일정 목록 조회 -->
	<select id="selectTeamSchedule" parameterType="int" resultType="TeamMainDTO">
	<![CDATA[
		select t1.team_name, sc.stadium_number, t2.team_name, to_char(sc.schedule_date, 'MM.DD. HH:mi')
		from tbl_game_schedule sc join tbl_stadium st on sc.home_team_number = st.team_number
		join tbl_team t1 on sc.home_team_number = t1.team_number
		join tbl_team t2 on sc.away_team_number = t2.team_number
		where sc.home_team_number = #{teamNumber} and rownum <= 5
	]]>
	</select>
	
	<!-- 팀 순위 목록 조회 -->
	<select id="selectTeamRank" resultType="TeamMainDTO">
	<![CDATA[
		select r.team_rank, t.team_name, r.game_count, r.team_win, r.team_draw, r.team_lose, r.team_win_rate
		from tbl_team_record r join tbl_team t on r.team_number = t.team_number
		where season_year = to_number(to_char(sysdate, 'YYYY'))
		order by r.team_win_rate desc
	]]>
	</select>

</mapper>